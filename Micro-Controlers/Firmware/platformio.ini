; platformio.ini
; IRWP v1.5 - Multi-Platform Build Configuration
; NEVER SHUTS DOWN - STAYS ON UNTIL POWER SWITCHED OFF

[platformio]
default_envs = esp32dev, pico, nano, stm32_bluepill
src_dir = .

; ==========================================
; ESP32 DevKit C (Primary Recommended Platform)
; ==========================================
[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino
board_build.f_cpu = 240000000L
lib_deps = 
    adafruit/Adafruit MPU6050 @ ^1.1.1
    bblanchon/ArduinoJson @ ^6.21.3
build_flags = 
    -D ESP32
    -D CORE_DEBUG_LEVEL=0
    -D SerialMon=Serial
    -D LED_BUILTIN=2
upload_speed = 921600
monitor_speed = 115200
monitor_filters = esp32_exception_decoder, time
extra_scripts = 
    pre:build_script.py

; ==========================================
; Raspberry Pi Pico (RP2040)
; ==========================================
[env:pico]
platform = raspberrypi
board = pico
framework = arduino
board_build.f_cpu = 133000000L
lib_deps = 
    adafruit/Adafruit MPU6050 @ ^1.1.1
    bblanchon/ArduinoJson @ ^6.21.3
build_flags = 
    -D ARDUINO_RASPBERRY_PI_PICO
    -D USB_STACK_ARMCORE
    -D SerialMon=Serial
    -D LED_BUILTIN=25
upload_protocol = uf2
upload_port = /media/$USER/RPI-RP2
monitor_speed = 115200
monitor_filters = time

; ==========================================
; Arduino Nano (ATmega328P)
; ==========================================
[env:nano]
platform = atmelavr
board = nanoatmega328
framework = arduino
board_build.f_cpu = 16000000L
lib_deps = 
    adafruit/Adafruit MPU6050 @ ^1.1.1
    bblanchon/ArduinoJson @ ^6.21.3
build_flags = 
    -D ARDUINO_AVR_NANO
    -D SerialMon=Serial
    -D LED_BUILTIN=13
    -D EEPROM_FLASH_MODE
upload_speed = 57600
monitor_speed = 115200
monitor_filters = time

; ==========================================
; STM32 Blue Pill (STM32F103C8)
; ==========================================
[env:stm32_bluepill]
platform = ststm32
board = bluepill_f103c8
framework = arduino
board_build.f_cpu = 72000000L
lib_deps = 
    adafruit/Adafruit MPU6050 @ ^1.1.1
    bblanchon/ArduinoJson @ ^6.21.3
build_flags = 
    -D STM32F1xx
    -D ARDUINO_BLUEPILL_F103C8
    -D USB_SEREMU
    -D SerialMon=Serial
    -D LED_BUILTIN=PC13
    -D PIO_FRAMEWORK_ARDUINO_ENABLE_CDC
    -D PIO_FRAMEWORK_ARDUINO_NANOLIB_FLOAT_PRINTF
upload_protocol = stlink
upload_speed = 1800000
monitor_speed = 115200
monitor_filters = time

; ==========================================
; Build Script (Auto-generate version header)
; ==========================================
[extra]
build_script = """
Import("env")
from datetime import datetime

# Auto-generate build timestamp
timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
version_flag = f'-D BUILD_TIMESTAMP=\\"{timestamp}\\"'
env.Append(CPPDEFINES=version_flag)

# Enable all warnings
env.Append(CCFLAGS=["-Wall", "-Wextra"])
"""
